---
title: "Laboratori de Shell Scripting (I)"
subtitle: "Unitat 7 Â· Sistemes Operatius (SO)"
author: "Jordi Mateo FornÃ©s"
logo: "/figures/corporative/institute.png"
format: 
  revealjs:
    transition: fade
    slide-number: true
    incremental: true 
    chalkboard: false
    pdf-separate-fragments: false
    pdf-max-pages-per-slide: 1
    pdf-page-height: 900
    pdf-page-width: 1600
    footer: "Unitat 7 Â· Sistemes Operatius (SO) [ğŸ ](/index.html)</a>"
editor: visual

execute:
  freeze: auto
  echo: false
---

## R1: Variables {.smaller}

- Crea un script anomenat `variables.sh`.
- Declara dues variables: una anomenada `NOM` amb el teu nom i una altra anomenada `EDAT` amb la teva edat.
- Fes que l'script imprimeixi el missatge: `Hola, el meu nom Ã©s [NOM] i tinc [EDAT] anys.`

1. Defineix les variables `NOM` i `EDAT` dins de l'script.
2. Defineix les variables `NOM` i `EDAT` com a variables d'entorn abans d'executar l'script.

::: notes
``` bash
#!/bin/bash
NOM="Jordi"
EDAT=30
echo "Hola, el meu nom Ã©s $NOM i tinc $EDAT anys."
```
Per definir les variables com a variables d'entorn:
``` bash
export NOM="Jordi"
export EDAT=30
./variables.sh
```
:::

## R2: Les variables sempre sÃ³n cadenes {.smaller}

- Crea un script anomenat `suma.sh`.
- Declara dues variables anomenades `NUM1` i `NUM2` amb valors numÃ¨rics.
- Fes que l'script sumi els valors de `NUM1` i `NUM2` i imprimeixi el resultat.


::: notes
``` bash
#!/bin/bash
NUM1=5
NUM2=10
echo "La suma de $NUM1 i $NUM2 Ã©s: $NUM1 + $NUM2"
```
:::

## R3: AritmÃ¨tica {.smaller}

- Modifica l'script `suma.sh` per realitzar la suma correcta dels valors numÃ¨rics de `NUM1` i `NUM2`.
- `let RESULTAT=NUM1+NUM2`
- `RESULTAT=$((NUM1 + NUM2))`
- `RESULTAT=$(expr $NUM1 + $NUM2)`
- Fes servir `$(( ))`, que Ã©s lâ€™opciÃ³ moderna.

::: notes
Hi ha 3 maneres comunes de fer operacions aritmÃ¨tiques en bash:
``` bash
#!/bin/bash
NUM1=5
NUM2=10
let RESULTAT=NUM1+NUM2
echo "La suma de $NUM1 i $NUM2 Ã©s: $RESULTAT"

RESULTAT=$((NUM1 + NUM2))
echo "La suma de $NUM1 i $NUM2 Ã©s: $RESULTAT"

RESULTAT=$(expr $NUM1 + $NUM2)
echo "La suma de $NUM1 i $NUM2 Ã©s: $RESULTAT"
```

La diferÃ¨ncia principal entre les tres maneres Ã©s la sintaxi i l'Ãºs. `let` Ã©s especÃ­fic de bash, `$(( ))` Ã©s una sintaxi mÃ©s moderna i portÃ til, i `expr` Ã©s una comanda externa que pot ser menys eficient.

:::

## R4: Calculadora bÃ sica {.smaller}

- Crea un script anomenat `calculadora.sh`.
- Llegeix dos nÃºmeros i una operaciÃ³ (suma, resta, multiplicaciÃ³, divisiÃ³) com a arguments de lÃ­nia de comandes.
- Realitza l'operaciÃ³ i mostra el resultat.

::: notes
``` bash
#!/bin/bash
NUM1=$1
NUM2=$2
OPERACIO=$3
RESULTAT=''

[ "$OPERACIO" == "suma" ] && RESULTAT=$((NUM1 + NUM2))
[ "$OPERACIO" == "resta" ] && RESULTAT=$((NUM1 - NUM2))
[ "$OPERACIO" == "multiplicacio" ] && RESULTAT=$((NUM1 * NUM2))
[ "$OPERACIO" == "divisio" ] && RESULTAT=$((NUM1 / NUM2))
[ -z "$RESULTAT" ] && echo "OperaciÃ³ no vÃ lida" && exit 1

echo "El resultat de la $OPERACIO entre $NUM1 i $NUM2 Ã©s: $RESULTAT"
```
:::

## R5: Arrays bÃ sics {.smaller}

- Crea un script arrays.sh.
- Declara un array amb 4 fruites del diable 
- Declara un altre array amb 4 usuaris dâ€™aquestes fruites.
- Llista quin personatge tÃ© quina fruita.


:::{.fragment}
| Fruita del diable           | Usuari                      |
|-----------------------------|-----------------------------|
| Hito-Hito no Mi             | Luffy                       |
| Mera-Mera no Mi             | Ace/Sabo                    |
| Gura-Gura no Mi             | Barbablanca/Barbanegra      |
| Magu-Magu no Mi             | Akainu                      |
:::

:::{.fragment .center-container}
Els array en bash sÃ³n indexats comenÃ§ant des de 0.
:::

::: notes
``` bash
#!/bin/bash

# Fruites del diable (versiÃ³ actualitzada)
FRUITES=(
    "Hito-Hito no Mi, Model: Nika"   
    "Mera-Mera no Mi"                
    "Gura-Gura no Mi"               
    "Magu-Magu no Mi"                
)

USUARIS=(
    "Luffy"
    "Ace/Sabo"
    "Barbablanca/Barbanegra"
    "Akainu"
)

for i in ${!FRUITES[@]}; do
    echo "${USUARIS[i]} ha menjat la fruita: ${FRUITES[i]}"
done
```


:::

## R6: Diccionaris bÃ sics {.smaller}

- Crea un script anomenat `diccionaris.sh`.

:::{.fragment}
| Clau (Regne)        | Valor (Rei/Reina)          |
|---------------------|----------------------------|
| Dressrosa           | Doflamingo               |
| WholeCake           | Big Mom                  |
| Wano                | Kaido                    |
| Alabasta            | Cobra                    |
:::

- Inicialitza un diccionari amb el contingut de la taula.
- Fes un bucle per imprimir cada regne amb el seu rei/reina corresponent.


::: notes
``` bash
#!/bin/bash
declare -A REGNES

REGNES=(
  ["Dressrosa"]="Doflamingo"
  ["WholeCake"]="Big Mom"
  ["Wano"]="Kaido"
  ["Alabasta"]="Cobra"
)

for ILLA in "${!REGNES[@]}"; do
    echo "A $ILLA governa ${REGNES[$ILLA]}"
done
```
:::

## R7: Joc de les relacions {.smaller}

- Mostra els personatges disponibles.
- Demana a lâ€™usuari un personatge.
- Lâ€™usuari intenta endevinar la seva fruita del diable entre les opcions mostrades.
- Lâ€™script diu si ha encertat.


::: notes
``` bash
#!/bin/bash
declare -A FRUITES
FRUITES=(
  ["Luffy"]="Hito-Hito no Mi"
  ["Ace/Sabo"]="Mera-Mera no Mi"
  ["Barbablanca/Barbanegra"]="Gura-Gura no Mi"
  ["Akainu"]="Magu-Magu no Mi"
)

echo "Escull un personatge:"
read P

[ -z "${FRUITES[$P]}" ] && echo "Personatge no vÃ lid!" && exit 1

echo "${FRUITES[@]}"

echo "Quina Ã©s la seva fruita del diable?"
echo "${!FRUITES[@]}" 
read R

[ -z "$R" ] && echo "Resposta no vÃ lida!" && exit 1

[ "$R" == "${FRUITES[$P]}" ] && echo "Correcte! $P Ã©s el/la ${FRUITES[$P]}" || echo "Incorrecte! La fruita real Ã©s ${FRUITES[$P]}"
```
:::


## CH01 {.smaller}

Analitzeu el codi segÃ¼ent i digueu quin Ã©s el resultat de l'execuciÃ³ d'aquest script. Raoneu la resposta. Indicant per que el resultat Ã©s diferent del que s'espera.

```bash
cat > ch01.data << 'EOT'
102
071
210
153
EOT

clear
cat ch01.data
declare -i SUM=0

while read X; do
    SUM+=$X
done < ch01.data

echo "Suma: $SUM != 536"
rm -f ch01.data
```

Aquest exemple s'ha adaptat del Llibre **Bash It Out** de Sylvain Leroux. Podeu trobar mÃ©s informaciÃ³ amb [FOSS Linux Blog](https://itsfoss.com/).

::: notes
El resultat Ã©s diferent del que s'espera perquÃ¨ el nombre 071 no Ã©s un nombre decimal. Aquest nombre Ã©s un nombre octal. Per tant, el resultat de la suma Ã©s 522 i no 536. En bash, els nombres que comencen per 0 sÃ³n nombres octals. Per exemple, el nombre 071 en octal Ã©s el nombre 57 en decimal. Per tant, el resultat de la suma Ã©s 522 i no 536.

Per assegurar-nos que els nombres que llegim sÃ³n nombres decimals, podem utilitzar la comanda bc. Aquesta comanda ens permet avaluar expressions aritmÃ¨tiques. Per exemple, per avaluar l'expressiÃ³ aritmÃ¨tica 071:

```bash
echo "071" | bc
# Resultat: 71
```

Per tant, podem millorar el script anterior de la segÃ¼ent manera:

```bash
#!/bin/bash
# Nom: ch01.sh

cat > ch01.data << 'EOT'
102
071
210
153
EOT

clear
cat ch01.data
declare -i SUM=0

while read X; do
    SUM+=$(echo "$X" | bc)
done < ch01.data

echo "Suma: $SUM != 536"
rm -f ch01.data
```
:::